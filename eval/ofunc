#!/bin/bash

set -e

testfile=$OBU_TESTFILE
testcase=$OBU_TESTCASE
key=$OBU_KEY

oproxy="../oproxy"
ofunc="../ofunc"

# ofunc outputs intermediate logs to a logs/ folder
logfile=logs/ofunc/$testcase.log
mkdir -p "$(dirname "$logfile")"

# run
node --experimental-loader $ofunc/dist/index.js $testfile 2>&1 | tee logs/ofunc/$testcase.stdout.log

mv -T logs/cryptoLog.log $logfile

node $oproxy/dist/log/index.js -c $oproxy/src/tests/checks.js $logfile
